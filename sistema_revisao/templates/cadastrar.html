<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="apple-touch-icon" sizes="57x57" href="{{ url_for('static', filename='apple-icon-57x57.png') }}">
<link rel="apple-touch-icon" sizes="60x60" href="{{ url_for('static', filename='apple-icon-60x60.png') }}">
<link rel="apple-touch-icon" sizes="72x72" href="{{ url_for('static', filename='apple-icon-72x72.png') }}">
<link rel="apple-touch-icon" sizes="76x76" href="{{ url_for('static', filename='apple-icon-76x76.png') }}">
<link rel="apple-touch-icon" sizes="114x114" href="{{ url_for('static', filename='apple-icon-114x114.png') }}">
<link rel="apple-touch-icon" sizes="120x120" href="{{ url_for('static', filename='apple-icon-120x120.png') }}">
<link rel="apple-touch-icon" sizes="144x144" href="{{ url_for('static', filename='apple-icon-144x144.png') }}">
<link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='apple-icon-152x152.png') }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-icon-180x180.png') }}">
<link rel="icon" type="image/png" sizes="192x192"  href="{{ url_for('static', filename='android-icon-192x192.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="96x96" href="{{ url_for('static', filename='favicon-96x96.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="{{ url_for('static', filename='ms-icon-144x144.png') }}">
<meta name="theme-color" content="#ffffff">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastrar Novo Estudo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .cadastro-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            margin-top: 50px;
        }
        .form-control {
            border-radius: 10px;
            border: 1px solid #ddd;
            padding: 12px 15px;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-cadastrar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-cadastrar:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .user-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="cadastro-container">
                    <div class="text-center mb-4">
                        <h1><i class="bi bi-plus-circle-fill text-primary"></i> Cadastrar Novo Estudo</h1>
                        <p class="text-muted">Olá, <strong>{{ session.get('usuario_nome', 'Usuário') }}</strong>!</p>
                    </div>
                    
                    <div class="user-info">
                        <i class="bi bi-envelope-fill text-primary"></i> 
                        <strong>Email de notificação:</strong> {{ session.get('usuario_email', 'Não configurado') }}
                    </div>

                    <form id="form-cadastrar">
                        <div class="mb-3">
                            <label for="materia" class="form-label">
                                <i class="bi bi-book"></i> Matéria
                            </label>
                            <input type="text" class="form-control" id="materia" name="materia" 
                                   placeholder="Ex: Matemática, Português, História..." required />
                        </div>

                        <!-- Campos de Quiz -->
                        <div id="quiz-fields" class="border rounded p-3" style="display:none;">
                            <div class="mb-3">
                                <label for="quiz_pergunta" class="form-label">
                                    <i class="bi bi-question-circle"></i> Pergunta (Quiz)
                                </label>
                                <textarea class="form-control" id="quiz_pergunta" rows="2" placeholder="Digite a pergunta do quiz..."></textarea>
                            </div>
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Opção A</label>
                                    <input class="form-control" id="quiz_opcao_a" placeholder="Opção A" />
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Opção B</label>
                                    <input class="form-control" id="quiz_opcao_b" placeholder="Opção B" />
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Opção C</label>
                                    <input class="form-control" id="quiz_opcao_c" placeholder="Opção C" />
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Opção D</label>
                                    <input class="form-control" id="quiz_opcao_d" placeholder="Opção D" />
                                </div>
                            </div>
                            <div class="mt-3">
                                <label class="form-label">Resposta correta</label>
                                <select id="quiz_resposta_correta" class="form-select">
                                    <option value="A">Opção A</option>
                                    <option value="B">Opção B</option>
                                    <option value="C">Opção C</option>
                                    <option value="D">Opção D</option>
                                </select>
                            </div>
                            <div class="alert alert-info mt-3 mb-0">
                                <small>O Quiz cria múltipla escolha; na revisão, uma resposta correta sugere qualidade 4, caso contrário 0.</small>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="topico" class="form-label">
                                <i class="bi bi-tag"></i> Tópico
                            </label>
                            <input type="text" class="form-control" id="topico" name="topico" 
                                   placeholder="Ex: Equações do 2º grau, Interpretação de texto..." required />
                        </div>
                        
                        <!-- Tipo de conteúdo -->
                        <div class="mb-3">
                            <label for="tipo_conteudo" class="form-label">
                                <i class="bi bi-layers"></i> Tipo de conteúdo
                            </label>
                            <select id="tipo_conteudo" name="tipo_conteudo" class="form-select">
                                <option value="simples" selected>Simples</option>
                                <option value="flashcard">Flashcard (Pergunta/Resposta)</option>
                                <option value="quiz">Quiz (Múltipla escolha)</option>
                            </select>
                        </div>
                        
                        <!-- Campos de Flashcard -->
                        <div id="flashcard-fields" class="border rounded p-3" style="display:none;">
                            <div class="mb-3">
                                <label for="pergunta" class="form-label">
                                    <i class="bi bi-question-circle"></i> Pergunta
                                </label>
                                <textarea class="form-control" id="pergunta" rows="2" placeholder="Digite a pergunta do flashcard..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="resposta" class="form-label">
                                    <i class="bi bi-chat-dots"></i> Resposta
                                </label>
                                <textarea class="form-control" id="resposta" rows="2" placeholder="Digite a resposta do flashcard..."></textarea>
                            </div>
                            <div class="alert alert-info mb-0">
                                <small>Esses campos só são necessários quando o tipo for "Flashcard".</small>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-cadastrar btn-primary">
                                <i class="bi bi-check-circle"></i> Cadastrar Estudo
                            </button>
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Voltar ao Dashboard
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('form-cadastrar');
            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    const materia = document.getElementById('materia').value.trim();
                    const topico = document.getElementById('topico').value.trim();
                    
                    if (!materia || !topico) {
                        alert('Por favor, preencha todos os campos obrigatórios!');
                        return;
                    }
                    
                    const tipo_conteudo = document.getElementById('tipo_conteudo').value;
                    const pergunta = document.getElementById('pergunta') ? document.getElementById('pergunta').value.trim() : '';
                    const resposta = document.getElementById('resposta') ? document.getElementById('resposta').value.trim() : '';
                    // Quiz
                    const quiz_pergunta = document.getElementById('quiz_pergunta') ? document.getElementById('quiz_pergunta').value.trim() : '';
                    const opcA = document.getElementById('quiz_opcao_a') ? document.getElementById('quiz_opcao_a').value.trim() : '';
                    const opcB = document.getElementById('quiz_opcao_b') ? document.getElementById('quiz_opcao_b').value.trim() : '';
                    const opcC = document.getElementById('quiz_opcao_c') ? document.getElementById('quiz_opcao_c').value.trim() : '';
                    const opcD = document.getElementById('quiz_opcao_d') ? document.getElementById('quiz_opcao_d').value.trim() : '';
                    const quiz_resposta_correta = document.getElementById('quiz_resposta_correta') ? document.getElementById('quiz_resposta_correta').value : '';

                    if (tipo_conteudo === 'flashcard') {
                        if (!pergunta || !resposta) {
                            alert('Para Flashcard, preencha Pergunta e Resposta.');
                            return;
                        }
                    }
                    if (tipo_conteudo === 'quiz') {
                        if (!quiz_pergunta || !opcA || !opcB || !opcC || !opcD) {
                            alert('Para Quiz, preencha a pergunta e as 4 opções.');
                            return;
                        }
                    }

                    fetch('/cadastrar', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            materia, topico, tipo_conteudo,
                            pergunta, resposta,
                            quiz_pergunta, opcoes: {A: opcA, B: opcB, C: opcC, D: opcD}, 
                            quiz_resposta_correta
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'sucesso') {
                            alert('Estudo cadastrado com sucesso! Você receberá lembretes por email.');
                            form.reset();
                            window.location.href = '/';
                        } else {
                            alert('Erro: ' + data.mensagem);
                        }
                    })
                    .catch(() => alert('Erro ao cadastrar estudo. Tente novamente.'));
                });
            
            // Mostrar/ocultar campos de flashcard
            const tipoSelect = document.getElementById('tipo_conteudo');
            const fcFields = document.getElementById('flashcard-fields');
            const quizFields = document.getElementById('quiz-fields');
            if (tipoSelect && fcFields && quizFields) {
                const toggle = () => {
                    fcFields.style.display = tipoSelect.value === 'flashcard' ? 'block' : 'none';
                    quizFields.style.display = tipoSelect.value === 'quiz' ? 'block' : 'none';
                };
                tipoSelect.addEventListener('change', toggle);
                toggle();
            }
        }
        });
    </script>
</body>
</html>
